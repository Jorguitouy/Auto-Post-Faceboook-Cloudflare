<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Panel de control para publicar autom√°ticamente URLs en una fanpage de Facebook. Multi-proyecto, generaci√≥n de contenido con IA e integraci√≥n con Facebook Graph API.">
    <title>Facebook Auto-Publisher - Panel de Control Multi-Proyecto</title>
    <!--
        Dashboard UI styles moved to a separate file for better organization.
        Archivo: /src/dashboard.css
        Referencias:
        - README: https://github.com/Jorguitouy/Facebook-Autopost-Cloudflare#readme
        - Gu√≠a de Autorizaci√≥n: GUIA-AUTORIZACION-FACEBOOK.md
        - Gu√≠a Open Graph: OPEN-GRAPH-GUIDE.md
    -->
    <link rel="stylesheet" href="/dashboard.css">
    
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <span>üìò</span>
                <span>Facebook Auto-Publisher</span>
            </div>
            <div class="header-actions">
                <button onclick="refreshAll()">üîÑ Actualizar</button>
                <button class="success" onclick="publishNow()">‚ñ∂Ô∏è Publicar Ahora</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="showTab('projects')">üìÅ Proyectos</button>
            <button class="tab" onclick="showTab('posts')">üìù Posts</button>
            <button class="tab" onclick="showTab('ai')">ü§ñ Generador IA</button>
            <button class="tab" onclick="showTab('settings')">‚öôÔ∏è Configuraci√≥n</button>
        </div>

        <!-- Message Box -->
        <div id="message" class="message"></div>

        <!-- Dashboard Tab -->
        <div id="tab-dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Proyectos</h3>
                    <div class="value" id="totalProjects">0</div>
                </div>
                <div class="stat-card">
                    <h3>Proyectos Activos</h3>
                    <div class="value" id="activeProjects">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Posts</h3>
                    <div class="value" id="totalPosts">0</div>
                </div>
                <div class="stat-card">
                    <h3>Pendientes</h3>
                    <div class="value" id="pendingPosts">0</div>
                </div>
                <div class="stat-card">
                    <h3>Publicados</h3>
                    <div class="value" id="publishedPosts">0</div>
                </div>
                <div class="stat-card">
                    <h3>Errores</h3>
                    <div class="value" id="errorPosts">0</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>üìà Resumen de Proyectos</h2>
                </div>
                <div id="projectsSummary"></div>
            </div>
        </div>

        <!-- Projects Tab -->
        <div id="tab-projects" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>‚ûï Crear Nuevo Proyecto</h2>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nombre del Proyecto *</label>
                        <input type="text" id="projectName" placeholder="Mi Sitio Web">
                        <small>Nombre descriptivo para identificar el proyecto</small>
                    </div>
                    <div class="form-group">
                        <label>Dominio *</label>
                        <input type="text" id="projectDomain" placeholder="www.misitio.com">
                        <small>Dominio principal del sitio web</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="projectDescription" placeholder="Describe el contenido o tem√°tica de este proyecto..."></textarea>
                </div>
                
                <div class="form-grid">
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="projectAiEnabled" checked>
                        <label>Habilitar generaci√≥n de contenido con IA</label>
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="projectAutoPublish" checked>
                        <label>Publicar autom√°ticamente en horarios programados</label>
                    </div>
                </div>
                
                <button onclick="createProject()">‚ûï Crear Proyecto</button>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>üìÅ Mis Proyectos</h2>
                </div>
                <div id="projectsList" class="projects-grid"></div>
            </div>
        </div>

        <!-- Posts Tab -->
        <div id="tab-posts" class="tab-content">
            <div class="form-group">
                <label>Seleccionar Proyecto</label>
                <select id="postsProjectSelect" onchange="loadProjectPosts()">
                    <option value="">Selecciona un proyecto...</option>
                </select>
            </div>

            <div id="selectedProjectPosts"></div>
        </div>

        <!-- AI Tab -->
        <div id="tab-ai" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>ü§ñ Generador de Contenido con IA</h2>
                </div>
                
                <div class="form-group">
                    <label>Proyecto</label>
                    <select id="aiProjectSelect">
                        <option value="">Selecciona un proyecto...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>URL del contenido</label>
                    <input type="url" id="aiUrl" placeholder="https://tusitio.com/articulo">
                    <small>La IA analizar√° esta URL para generar contenido</small>
                </div>
                
                <div class="form-group">
                    <label>Contexto adicional (opcional)</label>
                    <textarea id="aiContext" placeholder="Agrega contexto adicional para que la IA genere mejor contenido..."></textarea>
                </div>
                
                <button onclick="generateContent()">‚ú® Generar Contenido</button>
                
                <div id="aiResult" style="display:none;" class="mt-3">
                    <div class="form-group">
                        <label>T√≠tulo Generado</label>
                        <input type="text" id="aiGeneratedTitle" readonly>
                    </div>
                    <div class="form-group">
                        <label>Mensaje Generado</label>
                        <textarea id="aiGeneratedMessage" rows="4" readonly></textarea>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveGeneratedPost()">üíæ Guardar Post</button>
                        <button class="secondary" onclick="generateContent()">üîÑ Regenerar</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>üì¶ Generaci√≥n en Lote</h2>
                </div>
                
                <div class="form-group">
                    <label>Proyecto</label>
                    <select id="aiBulkProjectSelect">
                        <option value="">Selecciona un proyecto...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>URLs (una por l√≠nea)</label>
                    <textarea id="aiBulkUrls" rows="10" placeholder="https://tusitio.com/url1&#10;https://tusitio.com/url2&#10;https://tusitio.com/url3"></textarea>
                    <small>Ingresa una URL por l√≠nea</small>
                </div>
                
                <button onclick="generateBulkContent()">‚ú® Generar Todo el Contenido</button>
                
                <div id="bulkProgress" style="display:none;" class="mt-3">
                    <div class="loading active">
                        <div class="spinner"></div>
                        <p>Generando contenido... <span id="bulkProgressText">0/0</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="tab-settings" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>‚öôÔ∏è Configuraci√≥n del Sistema</h2>
                </div>
                
                <div class="message info">
                    <span>‚ÑπÔ∏è</span>
                    <div>
                        <strong>Configuraci√≥n de Credenciales</strong><br>
                        Las credenciales de Facebook y OpenAI se configuran mediante Wrangler Secrets.<br>
                        Ejecuta: <code>npx wrangler secret put FB_PAGE_ACCESS_TOKEN</code>
                    </div>
                </div>
                
                <h3 class="mb-2">üìò Facebook</h3>
                <p class="text-gray text-small mb-3">
                    Para configurar las credenciales de Facebook, necesitas crear una app en 
                    <a href="https://developers.facebook.com/" target="_blank">Facebook Developers</a>
                    y obtener un token de acceso de p√°gina.
                </p>
                
                <div class="form-group">
                    <label>Comandos para configurar:</label>
                    <textarea readonly rows="3">npx wrangler secret put FB_PAGE_ACCESS_TOKEN
npx wrangler secret put FB_PAGE_ID</textarea>
                </div>
                
                <h3 class="mb-2 mt-3">ü§ñ OpenAI</h3>
                <p class="text-gray text-small mb-3">
                    Para usar la generaci√≥n de contenido con IA, necesitas una API Key de OpenAI.
                    Obt√©n una en <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a>.
                </p>
                
                <div class="form-group">
                    <label>Comando para configurar:</label>
                    <textarea readonly rows="1">npx wrangler secret put OPENAI_API_KEY</textarea>
                </div>
                
                <h3 class="mb-2 mt-3">‚è∞ Horarios de Publicaci√≥n</h3>
                <p class="text-gray text-small mb-3">
                    Los horarios de publicaci√≥n autom√°tica se configuran en el archivo <code>wrangler.toml</code>
                    usando cron triggers.
                </p>
                
                <div class="form-group">
                    <label>Ejemplo de configuraci√≥n:</label>
                    <textarea readonly rows="5">[triggers]
crons = [
  "0 9 * * *",   # 9:00 AM UTC
  "0 14 * * *",  # 2:00 PM UTC
  "0 19 * * *"   # 7:00 PM UTC
]</textarea>
                </div>
                
                <button onclick="window.open('https://github.com/Jorguitouy/Facebook-Autopost-Cloudflare', '_blank')">
                    üìñ Ver Documentaci√≥n Completa
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para editar proyecto -->
    <div id="editProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Proyecto</h2>
                <button class="modal-close" onclick="closeEditProjectModal()">√ó</button>
            </div>
            
            <input type="hidden" id="editProjectId">
            
            <div class="form-group">
                <label>Nombre del Proyecto</label>
                <input type="text" id="editProjectName">
            </div>
            
            <div class="form-group">
                <label>Dominio</label>
                <input type="text" id="editProjectDomain">
            </div>
            
            <div class="form-group">
                <label>Descripci√≥n</label>
                <textarea id="editProjectDescription"></textarea>
            </div>
            
            <div class="form-group checkbox-group">
                <input type="checkbox" id="editProjectActive">
                <label>Proyecto activo</label>
            </div>
            
            <div class="flex gap-2 mt-3">
                <button onclick="saveEditProject()">üíæ Guardar Cambios</button>
                <button class="secondary" onclick="closeEditProjectModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="/dashboard.js" defer></script>
</body>
</html>
